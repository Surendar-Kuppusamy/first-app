<div class="container">
    <h1 class="text-center">Add Products</h1>
    <div class="productAddForm">
        <div class="row">
            <div class="col-sm-12 text-right">
                <div class="avatar_image">
                    <!-- <span class="badge badge-pill badge-danger delete" *ngIf="this.product_image!='http://localhost/Server/Angular10/first-app/src/assets/images/nature1.jpg'"><fa-icon [icon]="faTimes"></fa-icon></span> -->
                    <img [src]="this.product_image" alt="User Avatar" class="avatar" />
                </div>
            </div>
            <div class="col-sm-12 text-right mt-n3">
                <angular-file-uploader #fileUpload
                    [config]="afuConfig"
                    (ApiResponse)="uploadResponse($event)"
                    >
                </angular-file-uploader>
                <button class="btn btn-sm btn-outline-danger" (click)="removeProductImage()">Remove</button>
            </div>
        </div>
        <form [formGroup]="productAddForm">
            <div class="form-group">
                <label for="productName">
                    Product Name
                </label>
                <input type="text" class="form-control" id="productName" placeholder="Product Name" formControlName="name" />
            </div>
            <div class="form-group">
                <label for="productTypes">
                    Product Type
                </label>
                <ng-select class="custom" formControlName="type" id="productTypes" [hideSelected]="true" [items]="productTypes" bindLabel="type" bindValue="id" [addTag]="addTagPromise" [loading]="loading" [selectOnTab]="true" placeholder="Select Product Type">
                    <ng-template ng-tag-tmp let-search="searchTerm">
                        <b>Add Type</b>: {{search}}
                    </ng-template>
                </ng-select>
            </div>
            <div class="form-group">
                <label for="productDetail">
                    Product Details
                </label>
                <textarea class="form-control" formControlName="detail" row="3" id="productDetail" placeholder="Product Detail">
                </textarea>
            </div>
            <div class="form-group">
                <label for="productDiscountPercentage">
                    Discount Percntage
                </label>
                <div class="input-group mb-3">
                    <input type="text" formControlName="discountPercentage" class="form-control" id="productDiscountPercentage" placeholder="Discount Percentage(%)" />
                    <div class="input-group-append">
                      <span class="input-group-text custom-group-text">%</span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="productActualPrice">
                    Product Price
                </label>
                <input type="text" formControlName="price" class="form-control" id="productActualPrice" placeholder="Product Price" />
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="productBuyType">
                            Product Based On
                        </label>
                        <ng-select class="custom" formControlName="buyType" (change)="changeProductBuyType($event)" id="productBuyType" [items]="productBuyType" bindLabel="label" bindValue="value" [loading]="loading" placeholder="Product Buy Type"></ng-select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="productBuyTypeValue">
                            Product Based Value
                        </label>
                        <div class="input-group mb-3">
                            <input type="text" formControlName="buyTypeValue" class="form-control" id="productBuyTypeValue" placeholder="Product Buy Type Value" />
                            <div class="input-group-append">
                                <div ngbDropdown class="d-inline-block">
                                    <button class="btn btn-outline-primary" id="dropdownBasic1" ngbDropdownToggle><span *ngIf="this.productAddForm.value.buyTypeUnit == ''">Units</span><span *ngIf="this.productAddForm.value.buyTypeUnit != null">{{productAddForm.controls["buyTypeUnit"].value}}</span></button>
                                    <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                                        <button ngbDropdownItem  (click)="changeUnits('IT')" *ngIf="(this.productAddForm.value.buyType == 'QNT' || this.productAddForm.value.buyType == null) && this.productAddForm.value.buyTypeUnit != 'IT'">Number of Items</button>
                                        <button ngbDropdownItem  (click)="changeUnits('KG')" *ngIf="(this.productAddForm.value.buyType == 'WGT' || this.productAddForm.value.buyType == null) && this.productAddForm.value.buyTypeUnit != 'KG'">Kilo Gram</button>
                                        <button ngbDropdownItem  (click)="changeUnits('GR')" *ngIf="(this.productAddForm.value.buyType == 'WGT' || this.productAddForm.value.buyType == null) && this.productAddForm.value.buyTypeUnit != 'GR'">Gram</button>
                                        <button ngbDropdownItem  (click)="changeUnits('ML')" *ngIf="(this.productAddForm.value.buyType == 'LTR' || this.productAddForm.value.buyType == null) && this.productAddForm.value.buyTypeUnit != 'ML'">Milli Litre</button>
                                        <button ngbDropdownItem  (click)="changeUnits('LT')" *ngIf="(this.productAddForm.value.buyType == 'LTR' || this.productAddForm.value.buyType == null) && this.productAddForm.value.buyTypeUnit != 'LT'">Litre</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" formArrayName="taxes">
                <div class="col-md-12" *ngFor="let taxes of tax().controls; let i=index" [formGroupName]="i">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="productTax">
                                    Product Tax Name
                                </label>
                                <ng-select class="custom" formControlName="tax" (change)="changeTax($event, i)" id="productTax_{{i}}" [addTag]="addTagTax" [hideSelected]="true" [items]="productTax" bindLabel="name" bindValue="id" [selectOnTab]="true" [loading]="loading" placeholder="Product Tax">
                                    <ng-template ng-tag-tmp let-search="searchTerm">
                                        <b>Add tax</b>: {{search}}
                                    </ng-template>
                                </ng-select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="productTaxValue">
                                    Product Tax Percentage
                                </label>
                                    <input type="text" formControlName="value" class="form-control" id="productTaxValue" placeholder="Product Tax Value" />
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6 pt-1">
                            <div class="form-group">
                                <label></label>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-info" (click)="addTax(i)">Add Taxes</button>
                                    <button class="btn btn-sm btn-outline-info ml-3" (click)="removeTax(i)">Remove Taxes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-right">
                <button class="btn btn-primary" *ngIf="product_id==null" (click)="addProduct()">
                    Submit
                </button>
                <button class="btn btn-primary" *ngIf="product_id!=null" (click)="updateProduct()">
                    Update
                </button>
                
            </div>
        </form>
    </div>
</div>
